@page
@model best_hackathon_2025.Pages.IndexModel
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
@{
    ViewData["Title"] = "Головна";
}
<div class="app-container">
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <span class="menu-icon" id="menuToggle" style="user-select: none;">☰</span>
            <a href="/" class="app-name" id="appName">best_hackathon_2025</a>
        </div>
        <nav class="menu">
            <ul>
                <li><a class="active" style="user-select: none;"><span class="icon">🏠</span><span class="label">Головна</span></a></li>
                <li><a style="user-select: none;"><span class="icon">⭐</span><span class="label">Друга</span></a></li>
            </ul>
        </nav>
    </aside>
    <main class="main-content">
        <header class="topbar">
           <input type="text" id="searchInput" placeholder="Шукати на картах" class="search-box" />

            <a class="register-btn" href="/Auth/Register">Register</a>
            <a class="register-btn" href="/Auth/Login">Login</a>
            <a class="register-btn" href="/Auth/Profile">Profile</a>
        </header>
        <section class="map-section">
           <div id="map" style="height: 500px; width: 100%;"></div>
        </section>
    </main>
</div>

@section Scripts {
    <script>
        const toggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const labels = document.querySelectorAll('.label');
        const appName = document.getElementById('appName');

        toggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            labels.forEach(label => label.classList.toggle('hidden'));
            appName.classList.toggle('hidden');
        });

        let map; // глобальна змінна карти

        function initMap() {
            const center = { lat: 50.4501, lng: 30.5234 }; // Київ
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 12,
                center: center,
            });

            new google.maps.Marker({
                position: center,
                map: map,
                title: "Центр Києва"
            });

            setupSearch(); // ініціалізація пошуку
        }

        function setupSearch() {
            const searchInput = document.getElementById("searchInput");
            const geocoder = new google.maps.Geocoder();

            searchInput.addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                    const address = searchInput.value;
                    if (address.trim() === "") return;

                    geocoder.geocode({ address: address }, function (results, status) {
                        if (status === "OK" && results[0]) {
                            const location = results[0].geometry.location;
                            map.setCenter(location);
                            map.setZoom(14);

                            new google.maps.Marker({
                                map: map,
                                position: location,
                                title: address
                            });
                        } else {
                            alert("Місце не знайдено: " + status);
                        }
                    });
                }
            });
        }
    </script>

    <script async defer 
        src="https://maps.googleapis.com/maps/api/js?key=@Configuration["GoogleMaps:ApiKey"]&callback=initMap">
    </script>
}

}

}
