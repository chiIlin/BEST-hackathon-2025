@page
@model best_hackathon_2025.Pages.IndexModel
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
@{
    ViewData["Title"] = "–ì–æ–ª–æ–≤–Ω–∞";
}

<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="utf-8" />
    <title>CHILLGO - –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞</title>
    <link rel="stylesheet" href="~/css/site.css" />
    <link rel="stylesheet" href="~/css/index.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="~/css/chillgo-style.css" />
    <style>
        body.light-theme {
            /* –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è —Å–≤—ñ—Ç–ª–æ—ó —Ç–µ–º–∏, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ */
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header/Navigation Bar -->
        <header class="top-navbar">
            <div class="logo-container">
                <a href="/" class="logo-link">
                    <div class="logo-grid">
                        <div></div><div></div><div></div>
                        <div></div><div></div><div></div>
                        <div></div><div></div><div></div>
                    </div>
                    <span class="brand-name">CHILLGO</span>
                </a>
            </div>
            
            <div class="search-container">
                <div class="search-box">
                    <i class="bi bi-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫" oninput="searchPoints(this.value)" />
                    <div id="searchSuggestions" class="search-suggestions"></div>
                </div>
            </div>

            <div class="filter-container">
                <div class="filter-dropdown" onclick="toggleFilterMenu()">
                    <i class="bi bi-sliders filter-icon"></i>
                    <span id="selectedFilter" class="selected-filter">–£—Å—ñ –ø–æ—ñ–Ω—Ç–∏</span>
                    <div class="filter-menu" id="filterMenu">
                        <div class="filter-item" onclick="applyFilter('all')">–£—Å—ñ –ø–æ—ñ–Ω—Ç–∏</div>
                        <div class="filter-item" onclick="applyFilter('vision')">–í–∞–¥–∏ –∑–æ—Ä—É</div>
                        <div class="filter-item" onclick="applyFilter('hearing')">–í–∞–¥–∏ —Å–ª—É—Ö—É</div>
                        <div class="filter-item" onclick="applyFilter('movement')">–ü–æ—Ä—É—à–µ–Ω–Ω—è –û–†–ê</div>
                        <div class="filter-item" onclick="applyFilter('prosthesis')">–ü—Ä–æ—Ç–µ–∑–∏/–û—Ä—Ç–æ–ø–µ–¥—ñ—è</div>
                        <div class="filter-item" onclick="applyFilter('coordination')">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü—ñ—è —Ä—É—Ö—ñ–≤</div>
                    </div>
                </div>
            </div>

            <div class="nav-actions">
                <button id="themeToggle" class="nav-icon-button theme-toggle">
                    <i class="bi bi-moon-fill"></i>
                </button>
                <div class="auth-links">
                    <a href="/Auth/Login" class="nav-link">–£–≤—ñ–π—Ç–∏</a>
                    <a href="/Auth/Register" class="nav-link register-link">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
                </div>
            </div>
        </header>

        <!-- Main Content with Sidebar -->
        <div class="content-wrapper">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="info-section">
                    <h2 class="section-header">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è:</h2>
                    <div class="info-content" id="infoContent">
                        <p class="info-placeholder">–í–∏–±–µ—Ä—ñ—Ç—å —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç—ñ —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é</p>
                    </div>
                </div>

                <div class="reviews-section">
                    <h2 class="section-header">–í—ñ–¥–≥—É–∫–∏:</h2>
                    <div id="reviews" class="reviews-container">
                        <div class="review-placeholder">–ù–∞ –∂–∞–ª—å, –≤—ñ–¥–≥—É–∫—ñ–≤ –Ω–µ–º–∞—î(</div>
                        <div class="review-text">–ú–æ–∂–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ —Å–≤—ñ–π!</div>
                    </div>
                    
                    <div class="add-review">
                        <textarea id="rev" placeholder="–î–æ–¥–∞—Ç–∏ –≤—ñ–¥–≥—É–∫"></textarea>
                        <div class="rating-container">
                            <i class="bi bi-star star-rating"></i>
                            <i class="bi bi-star star-rating"></i>
                            <i class="bi bi-star star-rating"></i>
                            <i class="bi bi-star star-rating"></i>
                            <i class="bi bi-star star-rating"></i>
                            <input id="rate" type="hidden" value="0">
                        </div>
                        <button onclick="addReview()" class="add-review-btn">–î–æ–¥–∞—Ç–∏ –≤—ñ–¥–≥—É–∫</button>
                    </div>
                </div>
                
                <div class="location-indicator">
                    <i class="bi bi-geo-alt-fill location-icon"></i>
                    <span class="location-name">–õ—å–≤—ñ–≤</span>
                </div>
            </aside>

            <!-- Map Area -->
            <main class="main-content">
                <!-- Routing Options Panel -->
                <div class="route-panel">
                    <div class="route-inputs">
                        <div class="route-point">
                            <i class="bi bi-geo-alt-fill"></i>
                            <input type="text" id="pointAInput" placeholder="–ó–≤—ñ–¥–∫–∏?" />
                            <button class="set-point-btn" onclick="setPointAFromSelected()">–ó–∞–¥–∞—Ç–∏ —è–∫ —Ç–æ—á–∫—É A</button>
                        </div>
                        <div class="route-point">
                            <i class="bi bi-geo-alt-fill"></i>
                            <input type="text" id="pointBInput" placeholder="–ö—É–¥–∏?" />
                            <button class="set-point-btn" onclick="setPointBFromSelected()">–ó–∞–¥–∞—Ç–∏ —è–∫ —Ç–æ—á–∫—É B</button>
                        </div>
                        <button class="clear-route-btn" onclick="clearRouteInputs()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
                    </div>
                    
                    <div class="route-results" id="routeResults">
                        <h3>–ó–Ω–∞–π–¥–µ–Ω–æ 3 –º–∞—Ä—à—Ä—É—Ç–∏ –¥–ª—è —Ç–µ–±–µ</h3>
                        
                        <div class="route-option" id="route-option-0">
                            <div class="route-info">
                                <span class="route-number">–ú–∞—Ä—à—Ä—É—Ç 1: 22 —Ö–≤.</span>
                                <span class="route-details"></span>
                                <span class="route-inclusive">[–Ü–Ω–∫–ª—é–∑–∏–≤–Ω–∏–π]</span>
                            </div>
                        </div>
                        
                        <div class="route-option" id="route-option-1">
                            <div class="route-info">
                                <span class="route-number">–ú–∞—Ä—à—Ä—É—Ç 2: 18 —Ö–≤.</span>
                                <span class="route-details"></span>
                                <span class="route-partially">[–ß–∞—Å—Ç–∫–æ–≤–æ —ñ–Ω–∫–ª—é–∑–∏–≤–Ω–∏–π]</span>
                            </div>
                        </div>
                        
                        <div class="route-option" id="route-option-2">
                            <div class="route-info">
                                <span class="route-number">–ú–∞—Ä—à—Ä—É—Ç 3: 16 —Ö–≤.</span>
                                <span class="route-details"></span>
                                <span class="route-non-inclusive">[–ù–µ —ñ–Ω–∫–ª—é–∑–∏–≤–Ω–∏–π]</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Map Canvas -->
                <div id="map"></div>
                
                <!-- Controls -->
                <div class="map-controls">

                    <button class="zoom-button zoom-in">+</button>
                    <button class="zoom-button zoom-out">‚àí</button>
                </div>

                <div id="route-info-block" style="display: none;">
                    <b>–¢–æ—á–∫–∞ A:</b> <span id="pointA-text">–ù–µ –æ–±—Ä–∞–Ω–æ</span><br>
                    <b>–¢–æ—á–∫–∞ B:</b> <span id="pointB-text">–ù–µ –æ–±—Ä–∞–Ω–æ</span><br>
                    <button onclick="resetRoute()">–û—á–∏—Å—Ç–∏—Ç–∏ –º–∞—Ä—à—Ä—É—Ç</button>
                </div>
            </main>
        </div>
    </div>

    @section Scripts {
        <script>
            let map, userToken = localStorage.getItem('token');
            let directionsService, directionsRenderer, currentPosition;
            let markers = [];
            let suggestionIndex = -1;
            let currentSuggestions = [];

            async function getUserLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (pos) => {
                            currentPosition = {
                                lat: pos.coords.latitude,
                                lng: pos.coords.longitude
                            };
                        },
                        () => { alert("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∞—à—É –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—é"); }
                    );
                }
            }

            let routeLocked = false;
            let destinationMarker = null;

            let pointA = null;
            let pointB = null;
            let pointAMarker = null;
            let pointBMarker = null;
            let allPoints = []; // –≤—Å—ñ –ø–æ—ñ–Ω—Ç–∏
            let routePolylines = [];

            const inclusivenessList = [
                "–ü–∞–Ω–¥—É—Å",
                "–õ—ñ—Ñ—Ç",
                "–¢–∞–∫—Ç–∏–ª—å–Ω–∞ –ø–ª–∏—Ç–∫–∞",
                "–ó–≤—É–∫–æ–≤—ñ —Å–∏–≥–Ω–∞–ª–∏",
                "–î—É–±–ª—é–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É —à—Ä–∏—Ñ—Ç–æ–º –ë—Ä–∞–π–ª—è",
                "–í–∫–∞–∑—ñ–≤–Ω–∏–∫–∏ –¥–ª—è —Å–ª–∞–±–æ–∑–æ—Ä–∏—Ö",
                "–Ü–Ω–∫–ª—é–∑–∏–≤–Ω–∞ –≤–±–∏—Ä–∞–ª—å–Ω—è",
                "–ü–∞—Ä–∫—É–≤–∞–Ω–Ω—è –¥–ª—è —ñ–Ω–≤–∞–ª—ñ–¥—ñ–≤",
                "–ó–∞–Ω–∏–∂–µ–Ω–∏–π –±–æ—Ä–¥—é—Ä",
                "–î–æ—Å—Ç—É–ø–Ω–∞ –∫–∞—Å–∞",
                "–î–æ—Å—Ç—É–ø–Ω–∏–π –≤—Ö—ñ–¥ –±–µ–∑ —Å—Ö–æ–¥—ñ–≤",
                "–°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ–±–ª—ñ",
                "–î—É–±–ª—é–≤–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∂–µ—Å—Ç–æ–≤–æ—é –º–æ–≤–æ—é",
                "–†–æ–∑–º—ñ—Ç–∫–∞ –Ω–∞ –ø—ñ–¥–ª–æ–∑—ñ",
                "–ê–Ω—Ç–∏–∫–æ–≤–∑–∞—é—á–µ –ø–æ–∫—Ä–∏—Ç—Ç—è",
                "–ó–≤—É–∫–æ–≤—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è",
                "–î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –≥—Ä–æ–º–∞–¥—Å—å–∫–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É",
                "–®–∏—Ä–æ–∫—ñ –ø—Ä–æ—Ö–æ–¥–∏ –¥–ª—è –∫–æ–ª—è—Å–æ–∫",
                "–ü–∞–Ω–¥—É—Å –≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—ñ",
                "–Ü–Ω—à–µ"
            ];

            const disabilityCategories = {
                vision: [
                    "–¢–∞–∫—Ç–∏–ª—å–Ω–∞ –ø–ª–∏—Ç–∫–∞",
                    "–ó–≤—É–∫–æ–≤—ñ —Å–∏–≥–Ω–∞–ª–∏",
                    "–î—É–±–ª—é–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É —à—Ä–∏—Ñ—Ç–æ–º –ë—Ä–∞–π–ª—è",
                    "–í–∫–∞–∑—ñ–≤–Ω–∏–∫–∏ –¥–ª—è —Å–ª–∞–±–æ–∑–æ—Ä–∏—Ö",
                    "–ó–≤—É–∫–æ–≤—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è"
                ],
                hearing: [
                    "–î—É–±–ª—é–≤–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∂–µ—Å—Ç–æ–≤–æ—é –º–æ–≤–æ—é",
                    "–í—ñ–∑—É–∞–ª—å–Ω—ñ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∏"
                ],
                movement: [
                    "–ü–∞–Ω–¥—É—Å",
                    "–õ—ñ—Ñ—Ç",
                    "–ó–∞–Ω–∏–∂–µ–Ω–∏–π –±–æ—Ä–¥—é—Ä",
                    "–î–æ—Å—Ç—É–ø–Ω–∏–π –≤—Ö—ñ–¥ –±–µ–∑ —Å—Ö–æ–¥—ñ–≤",
                    "–®–∏—Ä–æ–∫—ñ –ø—Ä–æ—Ö–æ–¥–∏ –¥–ª—è –∫–æ–ª—è—Å–æ–∫",
                    "–Ü–Ω–∫–ª—é–∑–∏–≤–Ω–∞ –≤–±–∏—Ä–∞–ª—å–Ω—è",
                    "–ü–∞–Ω–¥—É—Å –≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—ñ",
                    "–ü–∞—Ä–∫—É–≤–∞–Ω–Ω—è –¥–ª—è —ñ–Ω–≤–∞–ª—ñ–¥—ñ–≤"
                ],
                prosthesis: [
                    "–ê–Ω—Ç–∏–∫–æ–≤–∑–∞—é—á–µ –ø–æ–∫—Ä–∏—Ç—Ç—è",
                    "–î–æ—Å—Ç—É–ø–Ω–∏–π –≤—Ö—ñ–¥ –±–µ–∑ —Å—Ö–æ–¥—ñ–≤",
                    "–®–∏—Ä–æ–∫—ñ –ø—Ä–æ—Ö–æ–¥–∏ –¥–ª—è –∫–æ–ª—è—Å–æ–∫"
                ],
                coordination: [
                    "–ê–Ω—Ç–∏–∫–æ–≤–∑–∞—é—á–µ –ø–æ–∫—Ä–∏—Ç—Ç—è",
                    "–î–æ—Å—Ç—É–ø–Ω–∏–π –≤—Ö—ñ–¥ –±–µ–∑ —Å—Ö–æ–¥—ñ–≤",
                    "–†–æ–∑–º—ñ—Ç–∫–∞ –Ω–∞ –ø—ñ–¥–ª–æ–∑—ñ"
                ]
            };

            function clearPolylines() {
                routePolylines.forEach(p => p.setMap(null));
                routePolylines = [];
            }

            function updatePointsInfo() {
                document.getElementById('pointA-text').innerText = pointA ? `${pointA.lat().toFixed(5)}, ${pointA.lng().toFixed(5)}` : '–ù–µ –æ–±—Ä–∞–Ω–æ';
                document.getElementById('pointB-text').innerText = pointB ? `${pointB.lat().toFixed(5)}, ${pointB.lng().toFixed(5)}` : '–ù–µ –æ–±—Ä–∞–Ω–æ';
                
                // –¢–∞–∫–æ–∂ –æ–Ω–æ–≤–ª—é—î–º–æ –ø–æ–ª—è –≤–≤–æ–¥—É
                if (pointA) {
                    document.getElementById('pointAInput').value = `${pointA.lat().toFixed(5)}, ${pointA.lng().toFixed(5)}`;
                }
                
                if (pointB) {
                    document.getElementById('pointBInput').value = `${pointB.lat().toFixed(5)}, ${pointB.lng().toFixed(5)}`;
                }
            }

            function resetRoute() {
                if (pointAMarker) pointAMarker.setMap(null);
                if (pointBMarker) pointBMarker.setMap(null);
                pointA = null;
                pointB = null;
                routeLocked = false;
                updatePointsInfo();
                clearPolylines();
                directionsRenderer.set('directions', null);
                
                // –û—á–∏—â–∞—î–º–æ –ø–æ–ª—è –≤–≤–æ–¥—É
                document.getElementById('pointAInput').value = '';
                document.getElementById('pointBInput').value = '';
                
                // –•–æ–≤–∞—î–º–æ –º–∞—Ä—à—Ä—É—Ç–∏
                document.getElementById('routeResults').style.display = 'none';
            }

            async function buildRoute(A, B) {
                const request = {
                    origin: A,
                    destination: B,
                    travelMode: google.maps.TravelMode.TRANSIT,
                    provideRouteAlternatives: true
                };

                directionsService.route(request, async (result, status) => {
                    if (status !== 'OK') {
                        alert("–ù–µ –≤–¥–∞–ª–æ—Å—è –ø–æ–±—É–¥—É–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç");
                        return;
                    }

                    clearPolylines();

                    const routes = result.routes.slice(0, 3);
                    routes.sort((a, b) => a.legs[0].duration.value - b.legs[0].duration.value);

                    const colors = ['#28a745', '#ffc107', '#dc3545'];
                    const routeResults = document.getElementById('routeResults');
                    
                    // –û—á–∏—â–∞—î–º–æ —Ç–∞ –æ–Ω–æ–≤–ª—é—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫
                    routeResults.innerHTML = '<h3>–ó–Ω–∞–π–¥–µ–Ω–æ 3 –º–∞—Ä—à—Ä—É—Ç–∏ –¥–ª—è —Ç–µ–±–µ</h3>';
                    
                    routes.forEach((route, index) => {
                        const leg = route.legs[0];
                        const duration = leg.duration.text;
                        const distance = leg.distance.text;
                        const transportLines = leg.steps
                            .filter(s => s.transit)
                            .map(s => s.transit.line.short_name);
                        const isInclusive = transportLines.every(whitelistTransport);
                        const color = colors[index];
                        
                        // –í–∏–∑–Ω–∞—á–∞—î–º–æ —Ç–∏–ø –º–∞—Ä—à—Ä—É—Ç—É
                        let inclusivityType = '';
                        let inclusivityClass = '';
                        
                        if (isInclusive) {
                            inclusivityType = '[–Ü–Ω–∫–ª—é–∑–∏–≤–Ω–∏–π]';
                            inclusivityClass = 'route-inclusive';
                        } else if (index === 1) {
                            inclusivityType = '[–ß–∞—Å—Ç–∫–æ–≤–æ —ñ–Ω–∫–ª—é–∑–∏–≤–Ω–∏–π]';
                            inclusivityClass = 'route-partially';
                        } else if (index === 2) {
                            inclusivityType = '[–ù–µ —ñ–Ω–∫–ª—é–∑–∏–≤–Ω–∏–π]';
                            inclusivityClass = 'route-non-inclusive';
                        }

                        // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç –º–∞—Ä—à—Ä—É—Ç—É
                        routeResults.innerHTML += `
                            <div class="route-option" id="route-option-${index}" style="border-left: 5px solid ${color}">
                                <div class="route-info">
                                    <span class="route-number">–ú–∞—Ä—à—Ä—É—Ç ${index + 1}: ${leg.duration.text}</span>
                                    <span class="route-details"></span>
                                    <span class="${inclusivityClass}">${inclusivityType}</span>
                                </div>
                                <button onclick="selectRoute(${index})" class="select-route-btn">–û–±—Ä–∞—Ç–∏</button>
                            </div>
                        `;

                        const polyline = new google.maps.Polyline({
                            path: route.overview_path,
                            strokeColor: color,
                            strokeOpacity: 0.9,
                            strokeWeight: 5,
                            map: map
                        });
                        routePolylines.push(polyline);
                    });

                    // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –±–ª–æ–∫ –∑ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏
                    routeResults.style.display = 'block';
                    
                    window.allRoutesResult = result;
                    routeLocked = true;
                });
            }

            function selectRoute(index) {
                clearPolylines();

                const route = window.allRoutesResult.routes[index];

                const polyline = new google.maps.Polyline({
                    path: route.overview_path,
                    strokeColor: '#000000', // —á–æ—Ä–Ω–∏–π –¥–ª—è –≤–∏–±—Ä–∞–Ω–æ–≥–æ
                    strokeOpacity: 1,
                    strokeWeight: 6,
                    map: map
                });

                routePolylines.push(polyline);

                directionsRenderer.setDirections({
                    routes: [route]
                });

                const leg = route.legs[0];
                const routeResults = document.getElementById('routeResults');
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫
                routeResults.innerHTML = `<h3>–û–±—Ä–∞–Ω–æ –º–∞—Ä—à—Ä—É—Ç ${index + 1}</h3>`;
                
                // –î–æ–¥–∞—î–º–æ –¥–µ—Ç–∞–ª—å–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –º–∞—Ä—à—Ä—É—Ç—É
                leg.steps.forEach((step) => {
                    let instructionHTML = '';
                    
                    if (step.transit) {
                        instructionHTML = `
                            <div class="route-step transit-step">
                                <div class="step-icon">üöè</div>
                                <div class="step-detail">
                                    <span class="route-number">‚Ññ${step.transit.line.short_name}</span>
                                    <span>–∑ <b>${step.transit.departure_stop.name}</b> –¥–æ <b>${step.transit.arrival_stop.name}</b></span>
                                    <span>(${step.transit.line.vehicle.type})</span>
                                </div>
                            </div>`;
                    } else {
                        instructionHTML = `
                            <div class="route-step walk-step">
                                <div class="step-icon">üö∂‚Äç‚ôÇÔ∏è</div>
                                <div class="step-detail">
                                    <span>${step.instructions.replace(/<[^>]*>?/gm, '')}</span>
                                    <span>(${step.distance.text})</span>
                                </div>
                            </div>`;
                    }
                    
                    routeResults.innerHTML += instructionHTML;
                });
            }

            let currentTheme = localStorage.getItem('theme') || 'dark'; // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —Ç–µ–º–Ω–∞ —Ç–µ–º–∞

            function whitelistTransport(routeNumber) {
                const inclusiveRoutes = ["1–ê","3–ê","5–ê","6–ê","8–ê","9","10","16","18","22","23","24",
                "25","27","30","31","32","33","38","29","40","46","47A","48","49A","52","53","61","84","92",
                ]; // –¢–≤—ñ–π whitelist
                return inclusiveRoutes.includes(routeNumber);
            }

            async function initMap() {
                // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å—Ç–∏–ª—å –∫–∞—Ä—Ç–∏ –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ—ó —Ç–µ–º–∏
                const styleUrl = currentTheme === 'dark'
                    ? '/styles/map-style-dark.json'
                    : '/styles/map-style-light.json';
                const style = await fetch(styleUrl).then(res => res.json());
                getUserLocation();

                const center = { lat: 49.8397, lng: 24.0297 };
                map = new google.maps.Map(document.getElementById("map"), {
                    zoom: 12,
                    center,
                    styles: style,
                    disableDefaultUI: true,
                    zoomControl: false,
                    mapTypeControl: false,
                    streetViewControl: false,
                    fullscreenControl: false
                });

                directionsService = new google.maps.DirectionsService();
                directionsRenderer = new google.maps.DirectionsRenderer({ 
                    map: map,
                    suppressMarkers: true, // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –º–∞—Ä–∫–µ—Ä–∏ A —ñ B
                    polylineOptions: {
                        strokeColor: '#000000',
                        strokeWeight: 5,
                        strokeOpacity: 0.7
                    }
                });
                
                // Custom zoom controls
                document.querySelector('.zoom-in').addEventListener('click', () => {
                    map.setZoom(map.getZoom() + 1);
                });
                
                document.querySelector('.zoom-out').addEventListener('click', () => {
                    map.setZoom(map.getZoom() - 1);
                });
                
                const points = await (await fetch('/api/point')).json();
                points.forEach(addMarker);
                allPoints = points; // –∑–±–µ—Ä—ñ–≥–∞—é –≤—Å—ñ –ø–æ—ñ–Ω—Ç–∏

                setupSearch();
                setupThemeToggle();
                setupRouteInputs();
                setupStarRating();
                
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –∫–ª–∞—Å –¥–ª—è body –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
                document.body.classList.toggle('light-theme', currentTheme === 'light');

                map.addListener('click', (e) => {
                    if (routeLocked) return;

                    if (!pointA) {
                        pointA = e.latLng;
                        if (pointAMarker) pointAMarker.setMap(null);
                        pointAMarker = new google.maps.Marker({
                            position: pointA,
                            map: map,
                            label: "A",
                            animation: google.maps.Animation.DROP
                        });
                    } else if (!pointB) {
                        pointB = e.latLng;
                        if (pointBMarker) pointBMarker.setMap(null);
                        pointBMarker = new google.maps.Marker({
                            position: pointB,
                            map: map,
                            label: "B",
                            animation: google.maps.Animation.DROP
                        });
                        buildRoute(pointA, pointB);
                    }

                    updatePointsInfo();
                });
                
                // –°–ø–æ—á–∞—Ç–∫—É –ø—Ä–∏—Ö–æ–≤—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç—É
                document.getElementById('routeResults').style.display = 'none';
            }
            
            function setupRouteInputs() {
                // –û–±—Ä–æ–±–∫–∞ –≤–≤–µ–¥–µ–Ω–Ω—è –≤ –ø–æ–ª–µ "–ó–≤—ñ–¥–∫–∏"
                document.getElementById('pointAInput').addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        const searchText = this.value.trim();
                        const point = findPointByAddress(searchText);
                        
                        if (point) {
                            setPointA({lat: point.latitude, lng: point.longitude});
                            if (pointB) buildRoute(pointA, pointB);
                            document.getElementById('searchInput').value = ''; // –û—á–∏—â–∞—î–º–æ –ø–æ–ª–µ
                        }
                    }
                });
                
                // –û–±—Ä–æ–±–∫–∞ –≤–≤–µ–¥–µ–Ω–Ω—è –≤ –ø–æ–ª–µ "–ö—É–¥–∏"
                document.getElementById('pointBInput').addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        const searchText = this.value.trim();
                        const point = findPointByAddress(searchText);
                        
                        if (point) {
                            setPointB({lat: point.latitude, lng: point.longitude});
                            if (pointA) buildRoute(pointA, pointB);
                            document.getElementById('searchInput').value = ''; // –û—á–∏—â–∞—î–º–æ –ø–æ–ª–µ
                        }
                    }
                });
            }
            
            function findPointByAddress(address) {
                return allPoints.find(p => 
                    p.address && p.address.toLowerCase().includes(address.toLowerCase())
                );
            }
            
            function setupStarRating() {
                const stars = document.querySelectorAll('.star-rating');
                
                stars.forEach((star, index) => {
                    star.addEventListener('click', () => {
                        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ä–µ–π—Ç–∏–Ω–≥
                        document.getElementById('rate').value = index + 1;
                        
                        // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑—ñ—Ä–æ–∫
                        stars.forEach((s, i) => {
                            if (i <= index) {
                                s.classList.remove('bi-star');
                                s.classList.add('bi-star-fill');
                            } else {
                                s.classList.remove('bi-star-fill');
                                s.classList.add('bi-star');
                            }
                        });
                    });
                    
                    // –î–æ–¥–∞—î–º–æ –µ—Ñ–µ–∫—Ç –Ω–∞–≤–µ–¥–µ–Ω–Ω—è
                    star.addEventListener('mouseover', () => {
                        stars.forEach((s, i) => {
                            if (i <= index) {
                                s.classList.add('star-hover');
                            }
                        });
                    });
                    
                    star.addEventListener('mouseout', () => {
                        stars.forEach(s => s.classList.remove('star-hover'));
                    });
                });
            }

            function getColor(loi) {
                if (loi <= 3) return "http://maps.google.com/mapfiles/ms/icons/red-dot.png";
                if (loi <= 7) return "http://maps.google.com/mapfiles/ms/icons/blue-dot.png";
                return "http://maps.google.com/mapfiles/ms/icons/green-dot.png";
            }

            function addMarker(p) {
                const m = new google.maps.Marker({
                    position: { lat: p.latitude, lng: p.longitude },
                    map,
                    icon: {
                        url: getColor(p.loi),
                        scaledSize: new google.maps.Size(32, 32)
                    }
                });

                m.addListener('click', () => {
                    showPointInfo(p);

                    if (!routeLocked) {
                        // –í–∏–¥–∞–ª—è—î–º–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–æ–∫ —É innerHTML
                        // –Ü–Ω—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω
                    }
                });
                markers.push(m);
            }

            async function recalculateLoi() {
                const res = await fetch('/api/point/calculateLoi', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ disabilityType: currentFilterType === 'all' ? null : currentFilterType })
                });

                const data = await res.json();

                allPoints.forEach(p => {
                    const newLoi = data.find(x => x.id === p.id)?.loi ?? p.loi;
                    p.loi = newLoi;
                });

                filterPoints();
            }


            async function loadReviews(pointId) {
                try {
                    const res = await fetch(`/api/review/byPointFull/${pointId}`);
                    const reviews = await res.json();

                    const reviewsContainer = document.getElementById('reviews');
                    
                    reviewsContainer.innerHTML = '';

                    if (reviews.length === 0) {
                        reviewsContainer.innerHTML = `
                            <div class="review-placeholder">–ù–∞ –∂–∞–ª—å, –≤—ñ–¥–≥—É–∫—ñ–≤ –Ω–µ–º–∞—î(</div>
                            <div class="review-text">–ú–æ–∂–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ —Å–≤—ñ–π!</div>
                        `;
                    } else {
                        reviews.forEach(review => {
                            const date = new Date(review.timeCreated).toLocaleString('uk-UA', {
                                day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit'
                            });

                            reviewsContainer.innerHTML += `
                                <div class="review-item">
                                    <div class="review-header">
                                        <span class="review-username">${review.userName}</span>
                                        <span class="review-date">${date}</span>
                                    </div>
                                    <div class="review-rating">
                                        ${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5 - review.rating)}
                                    </div>
                                    <div class="review-text">${review.reviewText}</div>
                                </div>
                            `;
                        });
                    }
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –≤—ñ–¥–≥—É–∫—ñ–≤:', error);
                }
            }



            async function showPointInfo(p) {
                selectedPoint = p;
                const infoContent = document.getElementById('infoContent');
                const reviewsSection = document.querySelector('.reviews-section');
                const addReviewSection = document.querySelector('.add-review');
                const displayLoi = p.manualLOI !== null && p.manualLOI !== undefined ? p.manualLOI : p.loi;

                let savedButtonText = '–ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–æ—á–∫—É';
                let savedButtonAction = `savePoint('${p.id}')`;

                if (userToken) {
                    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —Ç–æ—á–∫–∞ –≤–∂–µ –∑–±–µ—Ä–µ–∂–µ–Ω–∞
                    try {
                        const checkRes = await fetch(`/api/user/isPointSaved/${p.id}`, {
                            headers: { Authorization: 'Bearer ' + userToken }
                        });
                        
                        if (checkRes.ok) {
                            const isSaved = await checkRes.json();
                            if (isSaved) {
                                savedButtonText = '–¢–æ—á–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ - –í—ñ–¥–º—ñ–Ω–∏—Ç–∏';
                                savedButtonAction = `alert('–§—É–Ω–∫—Ü—ñ—è –≤—ñ–¥–º—ñ–Ω–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —â–µ –Ω–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞');`;
                            }
                        }
                    } catch (err) {
                        console.error("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–æ—á–∫–∏:", err);
                    }
                }

                // –Ü–Ω—Ñ–∞ –ø—Ä–æ –ø–æ—ñ–Ω—Ç
                infoContent.innerHTML = `
                    <p class="info-item"><strong>${p.address || '–ù–∞–∑–≤–∞ –º—ñ—Å—Ü—è, –≤—É–ª–∏—Ü—ñ'}</strong></p>
                    <p class="info-item"><strong>–û–ø–∏—Å:</strong> ${p.description || '–ù–µ–º–∞—î –æ–ø–∏—Å—É'}</p>
                    <p class="info-item"><strong>–î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å(0-10):</strong> ${displayLoi}
                                            ${userToken ? `<a href="/Admin/ChangeLOI?pointId=${p.id}" style="margin-left:10px; font-style:italic; color:#4caf50; text-decoration:underline; cursor:pointer;">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ?</a>` : ''}
                    </p>
                    <p class="info-item"><strong>–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó:</strong> ${(p.categories ?? []).join(', ') || '-'}</p>
                    <p class="info-item"><strong>–ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ:</strong> ${p.verified ? '–¢–∞–∫' : '–ù—ñ'}</p>
                    <button class="save-point-btn" onclick="${savedButtonAction}">${savedButtonText}</button>
                `;

                reviewsSection.style.display = 'block';
                addReviewSection.style.display = 'block';

                // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≤—ñ–¥–≥—É–∫–∏
                await loadReviews(p.id);

                document.getElementById('rev').value = '';
                document.getElementById('rate').value = 0;
                document.querySelectorAll('.star-rating').forEach(star => {
                    star.classList.remove('bi-star-fill');
                    star.classList.add('bi-star');
                });
            }


            async function addReview() {
                if (!selectedPoint) {
                    alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ç–æ—á–∫—É, —â–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –≤—ñ–¥–≥—É–∫.");
                    return;
                }

                const reviewText = document.getElementById('rev').value;
                const rating = +document.getElementById('rate').value;
                
                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –Ω–µ –ø—É—Å—Ç–∏–π –≤—ñ–¥–≥—É–∫
                if (!reviewText || rating === 0) {
                    alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –≤—ñ–¥–≥—É–∫—É —Ç–∞ –ø–æ—Å—Ç–∞–≤—Ç–µ –æ—Ü—ñ–Ω–∫—É.");
                    return;
                }

                const body = {
                    pointId: selectedPoint.id,
                    reviewText: reviewText,
                    rating: rating
                };

                const res = await fetch('/api/review', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + userToken
                    },
                    body: JSON.stringify(body)
                });

                if (res.ok) {
                    // –û—á–∏—â–∞—î–º–æ –ø–æ–ª–µ –≤–≤–æ–¥—É –≤—ñ–¥–≥—É–∫—É
                    document.getElementById('rev').value = '';
                    
                    // –°–∫–∏–¥–∞—î–º–æ —Ä–µ–π—Ç–∏–Ω–≥ –∑—ñ—Ä–æ–∫ –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Å—Ç–∞–Ω—É
                    document.getElementById('rate').value = 0;
                    document.querySelectorAll('.star-rating').forEach(star => {
                        star.classList.remove('bi-star-fill');
                        star.classList.add('bi-star');
                    });
                    
                    // –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≤—ñ–¥–≥—É–∫–∏
                    await loadReviews(selectedPoint.id);
                } else {
                    const err = await res.text();
                    alert('–ü–æ–º–∏–ª–∫–∞: ' + err);
                }
            }

            async function updateLoi(id) {
                const newLoi = parseFloat(document.getElementById('loiInput').value);

                if (isNaN(newLoi) || newLoi < 0 || newLoi > 10) {
                    alert('LOI –º–∞—î –±—É—Ç–∏ –≤—ñ–¥ 0 –¥–æ 10');
                    return;
                }

                const res = await fetch(`/api/point/updateLoi/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + userToken
                    },
                    body: JSON.stringify({ loi: newLoi })
                });

                if (res.ok) {
                    alert('LOI –æ–Ω–æ–≤–ª–µ–Ω–æ');
                    selectedPoint.loi = newLoi;
                    showPointInfo(selectedPoint);  // –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –±–ª–æ–∫–∞
                    recalculateLoi(); // –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–∏
                } else {
                    const err = await res.text();
                    alert('–ü–æ–º–∏–ª–∫–∞: ' + err);
                }
            }

            async function editLoi(currentLoi, pointId) {
                const newLoi = prompt(`–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤–∏–π LOI (0-10):`, currentLoi);

                if (newLoi === null) return; // –í—ñ–¥–º—ñ–Ω–∞
                if (isNaN(newLoi) || newLoi < 0 || newLoi > 10) {
                    alert("–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è LOI");
                    return;
                }

                const res = await fetch(`/api/point/updateLoi/${pointId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + userToken
                    },
                    body: JSON.stringify({ loi: parseInt(newLoi) })
                });

                if (res.ok) {
                    alert("LOI —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ");
                    location.reload(); // –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É —â–æ–± –ø–æ–∫–∞–∑–∞–≤—Å—è –Ω–æ–≤–∏–π LOI
                } else {
                    const err = await res.text();
                    alert("–ü–æ–º–∏–ª–∫–∞: " + err);
                }
            }



            async function savePoint(id) {
                if (!userToken) {
                    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∞–±—Å–æ–ª—é—Ç–Ω–∏–π URL –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
                    window.location.href = '/Auth/Login';
                    return;
                }
                
                const button = document.querySelector('.save-point-btn');
                
                const res = await fetch('/api/user/savePoint/' + id, {
                    method: 'POST',
                    headers: { Authorization: 'Bearer ' + userToken }
                });
                
                if (res.ok) {
                    // –ó–º—ñ–Ω—é—î–º–æ —Ç–µ–∫—Å—Ç —ñ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –∫–Ω–æ–ø–∫–∏
                    button.textContent = '–¢–æ—á–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ - –í—ñ–¥–º—ñ–Ω–∏—Ç–∏';
                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ ID —Ç–æ—á–∫–∏ –≤ –∞—Ç—Ä–∏–±—É—Ç—ñ –¥–∞–Ω–∏—Ö
                    button.setAttribute('data-point-id', id);
                    // –ó–º—ñ–Ω—é—î–º–æ onclick –¥–ª—è –≤—ñ–¥–º—ñ–Ω–∏
                    button.onclick = function() { 
                        alert('–§—É–Ω–∫—Ü—ñ—è –≤—ñ–¥–º—ñ–Ω–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —â–µ –Ω–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞');
                        // –ê–±–æ –∫–æ–ª–∏ —É –≤–∞—Å –±—É–¥–µ API –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è:
                        // removeSavedPoint(id); 
                    };
                } else {
                    alert('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è');
                }
            }

            async function removeSavedPoint(id) {
                const button = document.querySelector('.save-point-btn');
                
                const res = await fetch('/api/user/removeSavedPoint/' + id, {
                    method: 'DELETE',
                    headers: { Authorization: 'Bearer ' + userToken }
                });
                
                if (res.ok) {
                    button.textContent = '–ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–æ—á–∫—É';
                    button.onclick = function() { savePoint(id); };
                } else {
                    alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–º—ñ–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è');
                }
            }

            function setPointA(position) {
                if (pointAMarker) pointAMarker.setMap(null);
                pointA = new google.maps.LatLng(position.lat, position.lng);
                pointAMarker = new google.maps.Marker({
                    position: pointA,
                    map: map,
                    label: "A",
                    animation: google.maps.Animation.DROP
                });
                updatePointsInfo();
                if (pointB) buildRoute(pointA, pointB);
            }

            function setPointB(position) {
                if (pointBMarker) pointBMarker.setMap(null);
                pointB = new google.maps.LatLng(position.lat, position.lng);
                pointBMarker = new google.maps.Marker({
                    position: pointB,
                    map: map,
                    label: "B",
                    animation: google.maps.Animation.DROP
                });
                updatePointsInfo();
                if (pointA) buildRoute(pointA, pointB);
            }

            function selectSearchPoint(lat, lng, p) {
                focusPoint(lat, lng);
                showPointInfo(p);

                const suggestions = document.getElementById('searchSuggestions');
                suggestions.style.display = 'none';
                suggestions.innerHTML = '';

                // –û—á–∏—â—É—î–º–æ –ø–æ–ª–µ –ø–æ—à—É–∫—É
                document.getElementById('searchInput').value = '';
            }

            function searchPoints(query) {
                const suggestions = document.getElementById('searchSuggestions');
                if (!query.trim()) {
                    suggestions.style.display = 'none';
                    suggestions.innerHTML = '';
                    return;
                }

                currentSuggestions = allPoints.filter(p => p.address.toLowerCase().includes(query.toLowerCase()));

                suggestions.innerHTML = '';
                currentSuggestions.forEach((p, index) => {
                    const item = document.createElement('div');
                    item.className = 'search-suggestion-item';
                    item.textContent = p.address;
                    item.onclick = () => {
                        selectSearchPoint(p.latitude, p.longitude, p);
                    };
                    suggestions.appendChild(item);
                });
                suggestions.style.display = 'block';
            }

            document.getElementById('searchInput').addEventListener('keydown', function(e) {
                const items = document.querySelectorAll('.search-suggestion-item');
                if (e.key === 'ArrowDown') {
                    suggestionIndex = Math.min(suggestionIndex + 1, items.length - 1);
                    highlightSuggestion(suggestionIndex);
                } else if (e.key === 'ArrowUp') {
                    suggestionIndex = Math.max(suggestionIndex - 1, 0);
                    highlightSuggestion(suggestionIndex);
                } else if (e.key === 'Enter') {
                    if (suggestionIndex >= 0 && currentSuggestions[suggestionIndex]) {
                        const p = currentSuggestions[suggestionIndex];
                        selectSearchPoint(p.latitude, p.longitude, p);
                    } else {
                        searchPoints(this.value.trim());
                        this.value = '';
                    }
                }
            });

            function highlightSuggestion(index) {
                const items = document.querySelectorAll('.search-suggestion-item');
                items.forEach((el, i) => el.classList.toggle('active', i === index));
            }

            function focusPoint(lat, lng) {
                map.setCenter({ lat, lng });
                map.setZoom(16);
            }

            function setupSearch() {

                const geocoder = new google.maps.Geocoder();

                document.getElementById('searchInput').addEventListener('input', e => {
                    searchPoints(e.target.value);
                });

                document.getElementById('searchInput').addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        searchPoints(this.value.trim());
                        this.value = ''; // –û—á–∏—â–∞—î–º–æ –ø–æ–ª–µ
                    }
                });

            }
            
            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–º–∏–∫–∞—á–∞ —Ç–µ–º–∏
            function setupThemeToggle() {
                const themeToggle = document.getElementById('themeToggle');
                const themeIcon = themeToggle.querySelector('i');
                
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω—É —ñ–∫–æ–Ω–∫—É –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
                updateThemeIcon(themeIcon);
                
                // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–¥—ñ–π –¥–ª—è –∫–Ω–æ–ø–∫–∏
                themeToggle.addEventListener('click', async () => {
                    // –ó–º—ñ–Ω—é—î–º–æ —Ç–µ–º—É
                    currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                    localStorage.setItem('theme', currentTheme);
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–∫–æ–Ω–∫—É
                    updateThemeIcon(themeIcon);
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∏–ª—å –∫–∞—Ä—Ç–∏
                    await updateMapStyle();
                    
                    // –î–æ–¥–∞—Ç–∫–æ–≤–æ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –∫–ª–∞—Å body –¥–ª—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è CSS-—Å—Ç–∏–ª—ñ–≤ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
                    document.body.classList.toggle('light-theme');
                });
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–∫–æ–Ω–∫–∏ —Ç–µ–º–∏
            function updateThemeIcon(iconElement) {
                if (currentTheme === 'dark') {
                    iconElement.className = 'bi bi-sun-fill'; // –ü–æ–∫–∞–∑—É—î–º–æ —Å–æ–Ω—Ü–µ, —â–æ–± –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–≤—ñ—Ç–ª—É —Ç–µ–º—É
                } else {
                    iconElement.className = 'bi bi-moon-fill'; // –ü–æ–∫–∞–∑—É—î–º–æ –º—ñ—Å—è—Ü—å, —â–æ–± –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Ç–µ–º–Ω—É —Ç–µ–º—É
                }
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∏–ª—é –∫–∞—Ä—Ç–∏
            async function updateMapStyle() {
                if (!map) return;

                const styleUrl = currentTheme === 'dark'
                    ? '/styles/map-style-dark.json'
                    : '/styles/map-style-light.json';
                
                try {
                    const style = await fetch(styleUrl).then(res => res.json());
                    map.setOptions({ styles: style });
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–∏–ª—é –∫–∞—Ä—Ç–∏:', error);
                }
            }


            function setPointAFromSelected() {
                if (!selectedPoint) {
                    alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç—ñ.");
                    return;
                }
                setPointA({ lat: selectedPoint.latitude, lng: selectedPoint.longitude });
            }

            function setPointBFromSelected() {
                if (!selectedPoint) {
                    alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç—ñ.");
                    return;
                }
                setPointB({ lat: selectedPoint.latitude, lng: selectedPoint.longitude });
            }
        </script>
        <script>
    function toggleFilterMenu() {
        const menu = document.getElementById('filterMenu');
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    function filterPoints(type = 'all') {
        markers.forEach(m => m.setMap(null)); // –∑–∞–±–∏—Ä–∞—î–º–æ –≤—Å—ñ –º–∞—Ä–∫–µ—Ä–∏
        markers = []; // —á–∏—Å—Ç–∏–º–æ –º–∞—Å–∏–≤ –º–∞—Ä–∫–µ—Ä—ñ–≤

        let filteredPoints = [];

        if (type === 'all') {
            filteredPoints = allPoints;
        } else {
            const requiredCategories = disabilityCategories[type];
            filteredPoints = allPoints.filter(p =>
                p.categories && p.categories.some(c => requiredCategories.includes(c))
            );
        }

        // –†–∞—Ö—É—î–º–æ –Ω–æ–≤–∏–π LOI
        filteredPoints.forEach(p => {
            if (type === 'all') {
                p.loi = Math.round((p.categories.length / 20) * 10 * 100) / 100;
            } else {
                const requiredCategories = disabilityCategories[type];
                const matched = p.categories.filter(c => requiredCategories.includes(c)).length;
                p.loi = Math.round((matched / requiredCategories.length) * 10 * 100) / 100;
            }
        });

        filteredPoints.forEach(addMarker); // –ø–æ–∫–∞–∑—É—î–º–æ –º–∞—Ä–∫–µ—Ä–∏
    }

    function applyFilter(filterType) {
        toggleFilterMenu();
        currentFilterType = filterType;
        filterPoints(filterType);

        const filterNames = {
            all: "–£—Å—ñ –ø–æ—ñ–Ω—Ç–∏",
            vision: "–í–∞–¥–∏ –∑–æ—Ä—É",
            hearing: "–í–∞–¥–∏ —Å–ª—É—Ö—É",
            movement: "–ü–æ—Ä—É—à–µ–Ω–Ω—è –û–†–ê",
            prosthesis: "–ü—Ä–æ—Ç–µ–∑–∏/–û—Ä—Ç–æ–ø–µ–¥—ñ—è",
            coordination: "–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü—ñ—è —Ä—É—Ö—ñ–≤"
        };
        document.getElementById('selectedFilter').innerText = filterNames[filterType] || "–£—Å—ñ –ø–æ—ñ–Ω—Ç–∏";
    }









    // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–µ–Ω—é –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
    document.addEventListener('click', (e) => {
        const menu = document.getElementById('filterMenu');
        if (!menu.contains(e.target) && !e.target.classList.contains('filter-icon')) {
            menu.style.display = 'none';
        }
    });

    document.getElementById('selectedFilter').addEventListener('click', toggleFilterMenu);
</script>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=@Configuration["GoogleMaps:ApiKey"]&callback=initMap"></script>
        <script>
    function clearRouteInputs() {
        // –û—á–∏—â–∞—î–º–æ —Ç–µ–∫—Å—Ç–æ–≤—ñ –ø–æ–ª—è
        document.getElementById('pointAInput').value = '';
        document.getElementById('pointBInput').value = '';

        // –í–∏–¥–∞–ª—è—î–º–æ —Ç–æ—á–∫–∏ A —ñ B –∑ –∫–∞—Ä—Ç–∏
        if (pointAMarker) {
            pointAMarker.setMap(null);
            pointAMarker = null;
        }
        if (pointBMarker) {
            pointBMarker.setMap(null);
            pointBMarker = null;
        }

        // –°–∫–∏–¥–∞—î–º–æ –∑–º—ñ–Ω–Ω—ñ —Ç–æ—á–æ–∫
        pointA = null;
        pointB = null;

        // –û—á–∏—â–∞—î–º–æ –º–∞—Ä—à—Ä—É—Ç
        resetRoute();
    }
</script>
        <script>
document.addEventListener('DOMContentLoaded', () => {
    const reviewsSection = document.querySelector('.reviews-section');
    const addReviewSection = document.querySelector('.add-review');

    // –•–æ–≤–∞—î–º–æ —Å–µ–∫—Ü—ñ—é –≤—ñ–¥–≥—É–∫—ñ–≤ —ñ —Ñ–æ—Ä–º—É –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤—ñ–¥–≥—É–∫—ñ–≤
    reviewsSection.style.display = 'none';
    addReviewSection.style.display = 'none';
});
</script>
    }
</body>
</html>                     